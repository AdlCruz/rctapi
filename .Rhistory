ggplot(aes(x="", y = n, fill= reorder(AgeRange,desc(n)),label = n))+
geom_bar(width = 1, stat = "identity")+
geom_text(size = 3, position = position_stack(vjust = 0.5))+
coord_polar("y", start=0)
age_pie
by_studytype <- df %>% group_by(StudyType) %>% summarise(n= n())
studytype_pie <- by_studytype %>% arrange(desc(n)) %>%
ggplot(aes(x="", y = n, fill= reorder(StudyType,desc(n)),label = n))+
geom_bar(width = 1, stat = "identity")+
geom_text(size = 3, position = position_stack(vjust = 0.5))+
coord_polar("y", start=0)
studytype_pie
by_condition <- df  %>% group_by(Condition) %>% summarise(n= n())
condition_pie <- by_condition %>% arrange(desc(n)) %>% head(10) %>%
ggplot(aes(x="", y = n, fill= reorder(Condition,desc(n)),label = n))+
geom_bar(width = 1, stat = "identity")+
geom_text(size = 3, position = position_stack(vjust = 0.5))+
coord_polar("y", start=0) +
scale_color_brewer(palette = "Dark2")
condition_pie
status_enrollmentcount <- df %>%
ggplot(aes(x = OverallStatus, fill = OverallStatus, label = EnrollmentCount))+
geom_bar( position = "dodge")+
coord_flip()
status_enrollmentcount
status_enrollmentcount <- df %>%
ggplot(aes(x = OverallStatus, y = EnrollmentCount, fill = OverallStatus))+
geom_bar(stat = "identity", position = "dodge")+
coord_flip()
status_enrollmentcount
## app.R ##
library(shiny)
library(shinydashboard)
library(DT)
library(netmeta)
df <- df # data frame
# decide levels to keep and then save dataframe if not also show it live
# Define UI
ui <- fluidPage(
titlePanel("Explore, Plot, Select and Download data from your search of clinicaltrials.gov",
windowTitle = "Data Explorer"),
fluidRow(
column(2,
wellPanel(
checkboxGroupInput(
"show_vars","Columns to show:",names(df),selected_cols))
),
column(10,
tabsetPanel(id = 'dataset',
tabPanel("Data Table", DT::dataTableOutput("df"),
verbatimTextOutput("rowcolInd")),
tabPanel("Plots",plotOutput("meshterm_phase_barplot"),plotOutput("gender_pie"),
plotOutput("age_pie"),plotOutput("studytype_pie"),plotOutput("condition_pie")))
),
),
fluidRow(p(class = 'text-center', downloadButton('dldButton', 'Download Filtered Data')))
)
# Define server logic
server <- function(input, output) {
# choose columns to display
# row+column selection function
print_rows_cols = function(id) {
cat('Rows selected:\n')
print(input[[paste0(id, '_rows_selected')]])
cat('You can use the column names at the bottom of the table\nColumns selected:\n')
print(input[[paste0(id, '_columns_selected')]])
}
# data table output
output$df<- DT::renderDataTable({
DT::datatable(df[, input$show_vars, drop = FALSE],selection = list(target = 'row+column'),
options = list(lengthMenu = c(10, 50,100, 200), pageLength = 100, server = TRUE )
)
})
#plot outplot
# output$plot <- renderPlot({})
# row + column selection output
output$rowcolInd <- renderPrint(print_rows_cols("df"))
# download the filtered data
output$dldButton = downloadHandler('studies_filtered.csv', content = function(file) {
s = input$df_rows_all
write.csv(df[s, , drop = FALSE], file)
})
}
# Create Shiny app
shinyApp(ui = ui, server = server)
runApp('LSHTM/NMA Rctapi/explorer')
runApp('LSHTM/NMA Rctapi/explorer')
?tabsetPanel
?tabPanelBody
runApp('LSHTM/NMA Rctapi/explorer')
runApp('LSHTM/NMA Rctapi/explorer')
#make datatable
df <- datatable(df)
View(df)
#make datatable
df <- datatable(df) %>% formatStyle(names(df),lineHeight='80%')
df <- zf[,-1]
#Age Criteria columns
agecols <- c("MinimumAge","MaximumAge")
df$AgeRange <- do.call(paste, c(df[ , agecols], list(sep = '-')))
# Variables by type
charcols <- c("StudyType","OverallStatus","WhyStopped","IsFDARegulatedDrug","IsFDARegulatedDevice",
"IsUnapprovedDevice","OversightHasDMC","Condition","Keyword",
"DesignPrimaryPurpose","Phase","DesignInterventionModel","DesignMasking",
"DesignAllocation","ArmGroupLabel","ArmGroupType",
"InterventionType","InterventionName","InterventionMeshId","InterventionMeshTerm",
"PrimaryOutcomeMeasure","Gender","MinimumAge","MaximumAge","HealthyVolunteers")
datecols <- c("StartDate","CompletionDate")
numcols <- c("EnrollmentCount")
# Character columns into factors
df[charcols] <- lapply(df[charcols], factor)
# no empty columns
df <- df[, colSums( is.na(df) ) < nrow(zf)]
df <- datatable(df,
options = list(searching = FALSE,
pageLength = nrow(df),
dom = 't'),
rownames = FALSE,
selection = 'none')
df <- datatable(df,
options = list(searching = FALSE,
pageLength = nrow(df),
dom = 't'),
rownames = FALSE,
selection = 'none') %>% DT::formatStyle(names(df),lineHeight='80%')
nteers")
zf <- get_study_fields(search_expr = c("psoriatic arthritis"),fields = viz_fields)
zf <- get_study_fields(search_expr = c("psoriatic arthritis"),fields = viz_fields)
df <- zf[,-1]
#Age Criteria columns
agecols <- c("MinimumAge","MaximumAge")
df$AgeRange <- do.call(paste, c(df[ , agecols], list(sep = '-')))
# Variables by type
charcols <- c("StudyType","OverallStatus","WhyStopped","IsFDARegulatedDrug","IsFDARegulatedDevice",
"IsUnapprovedDevice","OversightHasDMC","Condition","Keyword",
"DesignPrimaryPurpose","Phase","DesignInterventionModel","DesignMasking",
"DesignAllocation","ArmGroupLabel","ArmGroupType",
"InterventionType","InterventionName","InterventionMeshId","InterventionMeshTerm",
"PrimaryOutcomeMeasure","Gender","MinimumAge","MaximumAge","HealthyVolunteers")
datecols <- c("StartDate","CompletionDate")
numcols <- c("EnrollmentCount")
# Character columns into factors
df[charcols] <- lapply(df[charcols], factor)
# no empty columns
df <- df[, colSums( is.na(df) ) < nrow(df)]
# no empty columns
xf <- df[, colSums( is.na(df) ) < nrow(df)]%>% DT::formatStyle(names(df),lineHeight='80%')
?formatStyle
output$df<- DT::renderDataTable({
DT::datatable(df[, input$show_vars, drop = FALSE],selection = list(target = 'row+column'),
options = list(lengthMenu = c(10, 50,100, 200), pageLength = 10, server = TRUE ),
class = "compact")
})
runApp('LSHTM/NMA Rctapi/explorer')
runApp('LSHTM/NMA Rctapi/explorer')
char_cols <- c("WhyStopped",
"OversightHasDMC","Keyword",
"ArmGroupLabel","ArmGroupType",
"InterventionType","InterventionName",
"PrimaryOutcomeMeasure")
fct_cols <- c("StudyType","OverallStatus","IsFDARegulatedDrug","IsFDARegulatedDevice",
"IsUnapprovedDevice","Condition","DesignPrimaryPurpose","Phase",
"DesignInterventionModel","DesignMasking","DesignAllocation",
"InterventionMeshId","InterventionMeshTerm","Gender","MinimumAge",
"MaximumAge","HealthyVolunteers")
df <- zf[,-1]
#Age Criteria columns
age_cols <- c("MinimumAge","MaximumAge")
df$AgeRange <- do.call(paste, c(df[ , age_cols], list(sep = '-')))
# Variables by type
fct_cols <- c("StudyType","OverallStatus","IsFDARegulatedDrug","IsFDARegulatedDevice",
"IsUnapprovedDevice","Condition","DesignPrimaryPurpose","Phase",
"DesignInterventionModel","DesignMasking","DesignAllocation",
"InterventionMeshId","InterventionMeshTerm","Gender","MinimumAge",
"MaximumAge","HealthyVolunteers")
char_cols <- c("WhyStopped",
"OversightHasDMC","Keyword",
"ArmGroupLabel","ArmGroupType",
"InterventionType","InterventionName",
"PrimaryOutcomeMeasure")
date_cols <- c("StartDate","CompletionDate")
num_cols <- c("EnrollmentCount")
num_cols <- c("EnrollmentCount")
# Character columns into factors
df[fct_cols] <- lapply(df[fct_cols], factor)
# no empty columns
df <- df[, colsums( is.na(df) ) < nrow(df)]
# no empty columns
df <- df[, colSums( is.na(df) ) < nrow(df)]
#make datatable
selected_cols <- c("NCTId","StudyType","OverallStatus","StartDate",
"CompletionDate","IsFDARegulatedDrug","IsFDARegulatedDevice","IsUnapprovedDevice",
"OversightHasDMC","Condition","DesignPrimaryPurpose","Phase",
"DesignInterventionModel","DesignMasking","DesignAllocation","EnrollmentCount",
"ArmGroupType","InterventionType",
"InterventionMeshTerm","Gender","MinimumAge","MaximumAge","HealthyVolunteers")
# df$StartDate <- parse_date_time(x = zf$StartDate,
runApp('LSHTM/NMA Rctapi/explorer')
?autoWidth
?datatable
runApp('LSHTM/NMA Rctapi/explorer')
runApp('LSHTM/NMA Rctapi/explorer')
runApp('LSHTM/NMA Rctapi/explorer')
runApp('LSHTM/NMA Rctapi/explorer')
runApp('LSHTM/NMA Rctapi/explorer')
runApp('LSHTM/NMA Rctapi/explorer')
runApp('LSHTM/NMA Rctapi/explorer')
runApp('LSHTM/NMA Rctapi/explorer')
runApp('LSHTM/NMA Rctapi/explorer')
runApp('LSHTM/NMA Rctapi/explorer')
shiny::runApp('GitHub/journal')
require(shiny)
require(shinyWidgets)
require(shinydashboard)
runApp('GitHub/journal')
?textAreaInput
runApp('GitHub/journal')
runApp('GitHub/journal')
runApp('GitHub/journal')
runApp('GitHub/journal')
runApp('GitHub/journal')
runApp('GitHub/journal')
runApp('GitHub/journal')
runApp('GitHub/journal')
runApp('GitHub/journal')
document()
library(devtools)
libary(rctapi)
library(rctapi)
library(rctexplorer)
launch_explorer(set_app_input("heart",max_studies = 100))
shiny::runApp('GitHub/rctexplorer/inst')
require(shiny)
require(shinydashboard)
require(DT)
require(dplyr)
require(ggplot2)
require(treemap)
require(RColorBrewer)
require(rctapi)
require(naniar)
require(plotly)
library(rctexplorer)
runApp('GitHub/rctexplorer/inst')
df <- set_app_input("psoriatic arthritis", max_studies = 100)
runApp('GitHub/rctexplorer/inst')
launch_explorer(df)
library(devtools)
install_github("AdlCruz/rctapi")
library(rctexplorer)
launch_explorer(df)
install_github("AdlCruz/rctapi")
install_github("AdlCruz/rctexplorer")
library(rctexplorer)
?launch_explorer
library(devtools)
install_github("AdlCruz/rctapi")
install_github("AdlCruz/rctexplorer")
library(rctapi)
library(rctexplorer)
launch_explorer(df)
update_packages("ellipsis")
shiny::runApp('GitHub/rctexplorer/inst/app')
library(rctapi)
library(rctexplorer)
df <- set_app_input("psoriatic arthritis", fields = for_explorer, max_studies = 500)
launch_explorer(df)
runApp('GitHub/rctexplorer/inst/app')
library(devtools)
library(rctapi)
library(rctexplorer)
#df <- get_study_fields("psoriatic arthritis", fields = for_explorer, max_studies = 100)
#
df <- set_app_input("psoriatic arthritis", fields = for_netmeta, max_studies = 500)
launch_explorer(df)
library(rctapi)
library(tidyr)
library(dplyr)
library(splitstackshape)
library(netmeta)
library(stringr)
library(edgebundleR)
library(igraph)
library(glue)
library(circlize)
df <- get_study_fields("psoriatic arthritis AND AREA[StudyType]Interventional", for_netmeta)
armify <- function(df) {
df <- df[,-which(names(df)=="Rank")]
make_wide <- cSplit(df,names(df[,-which(names(df)=="NCTId")]),sep = "|", drop = T)
make_character<- mutate(make_wide, across(everything(),as.character))
make_long <- pivot_longer(make_character,!c("NCTId"), names_to = c(".value","fields"), names_sep = "_", values_drop_na = T)
}
arms <- armify(df)
edges <- arms %>%
select(NCTId, fields,ArmGroupInterventionName) %>%
filter(!is.na(ArmGroupInterventionName)) %>%
filter(fields == "001" | fields == "002")
View(edges)
pairs <- pivot_wider(edges, id_cols = NCTId, names_from = fields, values_from = ArmGroupInterventionName)
pairs <- pairs[complete.cases(pairs),]
find <- c("Placebo","Adalimumab","Apremilast", "Methotrexate", "etanercept", "secukinumab")
find_exp <- paste0(find, collapse = "|")
res <- pairs %>%filter_all(any_vars(grepl(pattern = find_exp,., ignore.case = T)))
names(res)[names(res) == '001'] <- 'lab1'
names(res)[names(res) == '002'] <- 'lab2'
res$lab1 <- ifelse(grepl("placebo",res$lab1,ignore.case = T),"Any Placebo", res$lab1)
res$lab2 <- ifelse(grepl("placebo",res$lab2,ignore.case = T),"Any Placebo", res$lab2)
nodes <- c(res[,2],res[,3]) %>% unlist() %>% unique()
g <- graph.data.frame(res[,2:3], vertices = nodes, directed = F)
edgebundle(g, nodesize = c(0.1,30), padding = 150, fontsize = 10)
freq_pairs <- res %>% group_by(lab1,lab2) %>% summarize(freq = n())
circos.initialize()
chordDiagram(freq_pairs, annotationTrack = "grid", preAllocateTracks = list(track.height = 0.1))
circos.trackPlotRegion(track.index = 1, panel.fun = function(x, y) {
xlim = get.cell.meta.data("xlim")
xplot = get.cell.meta.data("xplot")
ylim = get.cell.meta.data("ylim")
sector.name = get.cell.meta.data("sector.index")
if(abs(xplot[2] - xplot[1]) < 10) {
circos.text(mean(xlim), ylim[1], sector.name, facing = "clockwise",
niceFacing = TRUE, adj = c(0, 0.5))
} else {
circos.text(mean(xlim), ylim[1], sector.name, facing = "inside",
niceFacing = TRUE, adj = c(0.5, 0))
}
}, bg.border = NA)
df <- set_app_input("psoriatic arthritis AND AREA[StudyType]Interventional", fields = for_explorer, max_studies = 500)
View(df)
View(arms)
View(edges)
View(pairs)
df <- set_app_input("psoriatic arthritis AND AREA[StudyType]Interventional", fields = for_explorer, max_studies = 500)
launch_explorer(df)
View(df)
df <- get_study_fields("psoriatic arthritis AND AREA[StudyType]Interventional", for_netmeta)
df <- get_study_fields("psoriatic arthritis AND AREA[StudyType]Interventional", for_netmeta)
View(df)
edges <- arms %>%
select(NCTId, fields,ArmGroupInterventionName) %>%
filter(!is.na(ArmGroupInterventionName)) %>%
filter(fields == "001" | fields == "002")
View(edges)
View(arms)
View(pairs)
View(res)
edgebundle(g, nodesize = c(0.1,30), padding = 150, fontsize = 10)
chordDiagram(freq_pairs, annotationTrack = "grid", preAllocateTracks = list(track.height = 0.1))
circos.trackPlotRegion(track.index = 1, panel.fun = function(x, y) {
xlim = get.cell.meta.data("xlim")
xplot = get.cell.meta.data("xplot")
ylim = get.cell.meta.data("ylim")
sector.name = get.cell.meta.data("sector.index")
if(abs(xplot[2] - xplot[1]) < 10) {
circos.text(mean(xlim), ylim[1], sector.name, facing = "clockwise",
niceFacing = TRUE, adj = c(0, 0.5))
} else {
circos.text(mean(xlim), ylim[1], sector.name, facing = "inside",
niceFacing = TRUE, adj = c(0.5, 0))
}
}, bg.border = NA)
?system.file
?get_study_fields
setwd("~/GitHub/rctapi")
#usethis::use_data(for_netmeta, overwrite = T)
################################################################################
for_explorer <-  c("NCTId","StudyType","OverallStatus","WhyStopped","StartDate",
"CompletionDate","IsFDARegulatedDrug","IsFDARegulatedDevice","IsUnapprovedDevice",
"OversightHasDMC","Condition","Keyword","DesignPrimaryPurpose","Phase",
"DesignInterventionModel","DesignMasking","DesignAllocation","EnrollmentCount",
"ArmGroupLabel","ArmGroupType","InterventionType","InterventionName","InterventionMeshId",
"InterventionMeshTerm","PrimaryOutcomeMeasure","Gender","MinimumAge","MaximumAge","HealthyVolunteers",
"ResultsFirstPostDate","OutcomeAnalysisParamValue","OutcomeAnalysisParamType","OutcomeAnalysisDispersionValue",
"OucomeMeasureType","OutcomeMeasureTitle","OutcomeGroupTitle","OutcomeGroupDescription",
"OutcomeMeasureParamType","OutcomeMeasureDispersionType","OutcomeCategoryTitle",
"OutcomeClassTitle","OutcomeClassDenomCountValue","OutcomeClassDenomUnits",
"OutcomeMeasurementValue","OutcomeMeasureUnitOfMeasure","OutcomeAnalysisGroupId".
"OutcomeAnalysisGroupDescription")
#usethis::use_data(for_netmeta, overwrite = T)
################################################################################
for_explorer <-  c("NCTId","StudyType","OverallStatus","WhyStopped","StartDate",
"CompletionDate","IsFDARegulatedDrug","IsFDARegulatedDevice","IsUnapprovedDevice",
"OversightHasDMC","Condition","Keyword","DesignPrimaryPurpose","Phase",
"DesignInterventionModel","DesignMasking","DesignAllocation","EnrollmentCount",
"ArmGroupLabel","ArmGroupType","InterventionType","InterventionName","InterventionMeshId",
"InterventionMeshTerm","PrimaryOutcomeMeasure","Gender","MinimumAge","MaximumAge","HealthyVolunteers",
"ResultsFirstPostDate","OutcomeAnalysisParamValue","OutcomeAnalysisParamType","OutcomeAnalysisDispersionValue",
"OucomeMeasureType","OutcomeMeasureTitle","OutcomeGroupTitle","OutcomeGroupDescription",
"OutcomeMeasureParamType","OutcomeMeasureDispersionType","OutcomeCategoryTitle",
"OutcomeClassTitle","OutcomeClassDenomCountValue","OutcomeClassDenomUnits",
"OutcomeMeasurementValue","OutcomeMeasureUnitOfMeasure","OutcomeAnalysisGroupId",
"OutcomeAnalysisGroupDescription")
setwd("~/GitHub/rctapi")
usethis::use_data(for_explorer, overwrite = T)
document()
library(devtools)
library(rctapi);library(rctexplorer)
document()
df <- set_app_input("psoriatic arthritis",fields = for_netmeta max_studies = 100)
df <- set_app_input("psoriatic arthritis",fields = for_netmeta, max_studies = 100)
View(df)
usethis::use_data(for_explorer, overwrite = T)
document()
# usethis::use_data(results_fields)
################################################################################
for_netmeta <-c("NCTId","ArmGroupLabel","ArmGroupType","ArmGroupDescription","ArmGroupInterventionName",
"InterventionArmGroupLabel","InterventionName","InterventionType","InterventionDescription",
"InterventionMeshId","InterventionMeshTerm","PrimaryOutcomeMeasure","SecondaryOutcomeMeasure",
"OtherOutcomeMeasure","OucomeMeasureType","OutcomeMeasureTitle","OutcomeGroupTitle","OutcomeGroupDescription",
"OutcomeMeasureParamType","OutcomeMeasureDispersionType","OutcomeCategoryTitle",
"OutcomeClassTitle","OutcomeClassDenomCountValue","OutcomeClassDenomUnits",
"OutcomeMeasurementValue","OutcomeMeasureUnitOfMeasure","OutcomeAnalysisParamType","OutcomeAnalysisParamValue",
"OutcomeAnalysisEstimateComment","OutcomeAnalysisDispersionType","OutcomeAnalysisDispersionValue",
"OutcomeAnalysisParamValue","OutcomeAnalysisParamType","OutcomeAnalysisDispersionValue",
"OutcomeAnalysisGroupId",
"OutcomeAnalysisGroupDescription")
usethis::use_data(for_netmeta, overwrite = T)
document()
df <- set_app_input("psoriatic arthritis",fields = for_netmeta, max_studies = 100)
# usethis::use_data(results_fields)
################################################################################
for_netmeta <-c("NCTId","ArmGroupLabel","ArmGroupType","ArmGroupDescription","ArmGroupInterventionName",
"InterventionArmGroupLabel","InterventionName","InterventionType","InterventionDescription",
"InterventionMeshId","InterventionMeshTerm","PrimaryOutcomeMeasure","SecondaryOutcomeMeasure",
"OtherOutcomeMeasure","OucomeMeasureType","OutcomeMeasureTitle","OutcomeGroupTitle","OutcomeGroupDescription",
"OutcomeMeasureParamType","OutcomeMeasureDispersionType","OutcomeCategoryTitle",
"OutcomeClassTitle","OutcomeClassDenomCountValue","OutcomeClassDenomUnits",
"OutcomeMeasurementValue","OutcomeMeasureUnitOfMeasure",
"OutcomeAnalysisEstimateComment","OutcomeAnalysisDispersionType","OutcomeAnalysisDispersionValue",
"OutcomeAnalysisParamValue","OutcomeAnalysisParamType","OutcomeAnalysisDispersionValue",
"OutcomeAnalysisGroupId","OutcomeAnalysisGroupDescription")
usethis::use_data(for_netmeta, overwrite = T)
document()
document()
df <- set_app_input("psoriatic arthritis", fields = for_netmeta, max_studies = 100)
for ( i in for_netmeta ) {
print(i)
if (i %in% all_fields) {
print("In")
else {print("Out")}
}
}
else {print("Out")}
for ( i in for_netmeta ) {
print(i)
if (i %in% all_fields) {
print("In")
}
else {print("Out")}
}
else {print("Out"); print(i)}
print(i)}
print(i)}
else {
print(i)
}
for ( i in for_netmeta ) {
if (i %in% all_fields) {
print("In")
}
else {
print(i)
}
}
usethis::use_data(for_netmeta, overwrite = T)
document()#
df <- set_app_input("psoriatic arthritis", fields = for_netmeta, max_studies = 100)
library(rctapi)
library(rctexplorer)
for_netmeta
install_github("AdlCruz/rctapi")
library(devtools)
library(devtools)
install_github("AdlCruz/rctapi")
install_github("AdlCruz/rctexplorer")
library(rctapi)
library(rctexplorer)
for_netmeta
df <- set_app_input("psoriatic arthritis", fields = for_netmeta, max_studies = 100)
launch_explorer(df)
for_netmeta
# netmetafy
#
#
#
df <- get_study_fields("psoriatic arthritis AND AREA[StudyType]Interventional", for_netmeta)
armify <- function(df) {
df <- df[,-which(names(df)=="Rank")]
make_wide <- cSplit(df,names(df[,-which(names(df)=="NCTId")]),sep = "|", drop = T)
make_character<- mutate(make_wide, across(everything(),as.character))
make_long <- pivot_longer(make_character,!c("NCTId"), names_to = c(".value","fields"), names_sep = "_", values_drop_na = T)
}
long_arms <- armify(df)
library(rctapi)
library(tidyr)
library(dplyr)
library(splitstackshape)
library(netmeta)
library(stringr)
library(edgebundleR)
library(igraph)
library(glue)
library(circlize)
library(netmeta)
armify <- function(df) {
df <- df[,-which(names(df)=="Rank")]
make_wide <- cSplit(df,names(df[,-which(names(df)=="NCTId")]),sep = "|", drop = T)
make_character<- mutate(make_wide, across(everything(),as.character))
make_long <- pivot_longer(make_character,!c("NCTId"), names_to = c(".value","fields"), names_sep = "_", values_drop_na = T)
}
long_arms <- armify(df)
long_arms <- armify(df)
View(df)
